import{_ as s,o as n,c as a,a as l}from"./app.9287c781.js";const C=JSON.parse('{"title":"selector","description":"","frontmatter":{},"headers":[{"level":2,"title":"é˜»å¡å’Œéé˜»å¡","slug":"é˜»å¡å’Œéé˜»å¡","link":"#é˜»å¡å’Œéé˜»å¡","children":[{"level":3,"title":"é˜»å¡","slug":"é˜»å¡","link":"#é˜»å¡","children":[]},{"level":3,"title":"æœåŠ¡å™¨ç«¯","slug":"æœåŠ¡å™¨ç«¯","link":"#æœåŠ¡å™¨ç«¯","children":[]},{"level":3,"title":"å®¢æˆ·ç«¯","slug":"å®¢æˆ·ç«¯","link":"#å®¢æˆ·ç«¯","children":[]}]},{"level":2,"title":"éé˜»å¡æ¨¡å¼","slug":"éé˜»å¡æ¨¡å¼","link":"#éé˜»å¡æ¨¡å¼","children":[{"level":3,"title":"æœåŠ¡å™¨ç«¯ä¿®æ”¹","slug":"æœåŠ¡å™¨ç«¯ä¿®æ”¹","link":"#æœåŠ¡å™¨ç«¯ä¿®æ”¹","children":[]},{"level":3,"title":"å¤šè·¯å¤ç”¨","slug":"å¤šè·¯å¤ç”¨","link":"#å¤šè·¯å¤ç”¨","children":[]}]},{"level":2,"title":"selector","slug":"selector-1","link":"#selector-1","children":[{"level":3,"title":"å¥½å¤„","slug":"å¥½å¤„","link":"#å¥½å¤„","children":[]},{"level":3,"title":"åˆ›å»º","slug":"åˆ›å»º","link":"#åˆ›å»º","children":[]},{"level":3,"title":"ç»‘å®šsocketChanneläº‹ä»¶","slug":"ç»‘å®šsocketchanneläº‹ä»¶","link":"#ç»‘å®šsocketchanneläº‹ä»¶","children":[]},{"level":3,"title":"ç›‘å¬channeläº‹ä»¶","slug":"ç›‘å¬channeläº‹ä»¶","link":"#ç›‘å¬channeläº‹ä»¶","children":[]},{"level":3,"title":"ğŸ’¡ select ä½•æ—¶ä¸é˜»å¡","slug":"ğŸ’¡-select-ä½•æ—¶ä¸é˜»å¡","link":"#ğŸ’¡-select-ä½•æ—¶ä¸é˜»å¡","children":[]}]},{"level":2,"title":"å¤„ç†acceptäº‹ä»¶","slug":"å¤„ç†acceptäº‹ä»¶","link":"#å¤„ç†acceptäº‹ä»¶","children":[{"level":3,"title":"ä¸ºä»€ä¹ˆè¿›è¡Œiter.remove()","slug":"ä¸ºä»€ä¹ˆè¿›è¡Œiter-remove","link":"#ä¸ºä»€ä¹ˆè¿›è¡Œiter-remove","children":[]},{"level":3,"title":"ğŸ’¡ cancel","slug":"ğŸ’¡-cancel","link":"#ğŸ’¡-cancel","children":[]},{"level":3,"title":"ä¸å¤„ç†è¾¹ç•Œçš„é—®é¢˜","slug":"ä¸å¤„ç†è¾¹ç•Œçš„é—®é¢˜","link":"#ä¸å¤„ç†è¾¹ç•Œçš„é—®é¢˜","children":[]}]}],"relativePath":"Netty/selector.md","lastUpdated":1674743384000}'),p={name:"Netty/selector.md"},e=l(`<h1 id="selector" tabindex="-1">selector <a class="header-anchor" href="#selector" aria-hidden="true">#</a></h1><p>ä½œè€…: fbk æ—¶é—´ï¼š2023-1-3 åœ°ç‚¹ï¼šæµå—</p><blockquote><p>è¶³å¤Ÿä¼˜ç§€å†å¤§æ–¹æ‹¥æœ‰</p></blockquote><h2 id="é˜»å¡å’Œéé˜»å¡" tabindex="-1">é˜»å¡å’Œéé˜»å¡ <a class="header-anchor" href="#é˜»å¡å’Œéé˜»å¡" aria-hidden="true">#</a></h2><h3 id="é˜»å¡" tabindex="-1">é˜»å¡ <a class="header-anchor" href="#é˜»å¡" aria-hidden="true">#</a></h3><ul><li>é˜»å¡æ¨¡å¼ä¸‹é¢çš„æ–¹æ³•éƒ½ä¼šè®©çº¿ç¨‹æš‚åœ <ul><li>ServerSocketChannel.acceptåœ¨æ²¡æœ‰è¿æ¥çš„æ—¶å€™çº¿ç¨‹æš‚åœ</li><li>SocketChannel.readä¼šåœ¨æ²¡æœ‰æ•°æ®å¯è¯»è®©çº¿ç¨‹æš‚åœ</li><li>é˜»å¡å°±æ˜¯çº¿ç¨‹æš‚åœäº†å¹¶ä¸”ä¸ä¼šå ç”¨cpuï¼Œç›¸å½“äºçº¿ç¨‹é—²ç½®</li></ul></li><li>å•çº¿ç¨‹ä¸‹ï¼Œé˜»å¡æ–¹æ³•ä¹‹é—´ç›¸äº’å½±å“ï¼Œä¸èƒ½å·¥ä½œï¼Œéœ€è¦å¤šçº¿ç¨‹</li><li>ä½†å¤šçº¿ç¨‹ä¹Ÿæœ‰é—®é¢˜ <ul><li>32 ä½ jvm ä¸€ä¸ªçº¿ç¨‹ 320kï¼Œ64 ä½ jvm ä¸€ä¸ªçº¿ç¨‹ 1024kï¼Œå¦‚æœè¿æ¥æ•°è¿‡å¤šï¼Œå¿…ç„¶å¯¼è‡´ OOMï¼Œå¹¶ä¸”çº¿ç¨‹å¤ªå¤šï¼Œåè€Œä¼šå› ä¸ºé¢‘ç¹ä¸Šä¸‹æ–‡åˆ‡æ¢å¯¼è‡´æ€§èƒ½é™ä½</li><li>å¯ä»¥é‡‡ç”¨çº¿ç¨‹æ± æŠ€æœ¯æ¥å‡å°‘çº¿ç¨‹æ•°å’Œçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä½†æ²»æ ‡ä¸æ²»æœ¬ï¼Œå¦‚æœæœ‰å¾ˆå¤šè¿æ¥å»ºç«‹ï¼Œä½†é•¿æ—¶é—´ inactiveï¼Œä¼šé˜»å¡çº¿ç¨‹æ± ä¸­æ‰€æœ‰çº¿ç¨‹ï¼Œå› æ­¤ä¸é€‚åˆé•¿è¿æ¥ï¼Œåªé€‚åˆçŸ­è¿æ¥</li></ul></li></ul><h3 id="æœåŠ¡å™¨ç«¯" tabindex="-1">æœåŠ¡å™¨ç«¯ <a class="header-anchor" href="#æœåŠ¡å™¨ç«¯" aria-hidden="true">#</a></h3><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;"> args</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> throws IOException </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">ServerSocketChannel</span><span style="color:#A6ACCD;"> ssc </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> ServerSocketChannel</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">open</span><span style="color:#89DDFF;">();</span><span style="color:#676E95;font-style:italic;">//åˆ›å»ºæœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">ByteBuffer</span><span style="color:#A6ACCD;"> buffer </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> ByteBuffer</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">allocate</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">16</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        ssc</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">bind</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">InetSocketAddress</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">8080</span><span style="color:#89DDFF;">));</span><span style="color:#676E95;font-style:italic;">//ç›‘å¬8080ç«¯å£</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">//åˆ›å»ºè¿æ¥</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">List</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">SocketChannel</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> channels</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">ArrayList</span><span style="color:#89DDFF;">&lt;&gt;();</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">while</span><span style="color:#89DDFF;">(true){</span></span>
<span class="line"><span style="color:#A6ACCD;">            log</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">debug</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">connecting</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#C792EA;">SocketChannel</span><span style="color:#A6ACCD;"> socketChannel </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> ssc</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">accept</span><span style="color:#89DDFF;">();</span><span style="color:#676E95;font-style:italic;">//çº¿ç¨‹åœæ­¢è¿è¡Œ</span></span>
<span class="line"><span style="color:#A6ACCD;">            channels</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">add</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">socketChannel</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">SocketChannel</span><span style="color:#A6ACCD;"> channel </span><span style="color:#89DDFF;font-style:italic;">:</span><span style="color:#A6ACCD;"> channels</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                channel</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">read</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">buffer</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">                buffer</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">flip</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">                buffer</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">clear</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="å®¢æˆ·ç«¯" tabindex="-1">å®¢æˆ·ç«¯ <a class="header-anchor" href="#å®¢æˆ·ç«¯" aria-hidden="true">#</a></h3><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#C792EA;">SocketChannel</span><span style="color:#A6ACCD;"> sc</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">SocketChannel</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">open</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">sc</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">connent</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">InetSocketAddress</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">localhost</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">8080</span><span style="color:#89DDFF;">))</span></span>
<span class="line"><span style="color:#A6ACCD;">System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">waiting</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="éé˜»å¡æ¨¡å¼" tabindex="-1">éé˜»å¡æ¨¡å¼ <a class="header-anchor" href="#éé˜»å¡æ¨¡å¼" aria-hidden="true">#</a></h2><ul><li>éé˜»å¡æ¨¡å¼ä¸ç®¡æ˜¯acceptè¿˜æ˜¯readéƒ½ä¸ä¼šè®©çº¿ç¨‹æš‚åœ <ul><li>åœ¨ServerSocketChannel.accept()æ²¡æœ‰å»ºç«‹è¿æ¥ä¼šè¿”å›SocketChannelæ˜¯null</li><li>åœ¨SocketChannel.readæ²¡æœ‰æ•°æ®æ—¶ï¼Œä¼šè¿”å›0ï¼Œä¸ä¼šé˜»å¡ï¼Œä¹Ÿå¯ä»¥æ‰§è¡Œreadæˆ–è€…acceptæ–¹æ³•</li></ul></li><li>ä½†æ˜¯ç¼ºç‚¹æ˜¯æ²¡æœ‰å»ºç«‹è¿æ¥å’Œåˆ»åº¦æ•°æ®ï¼Œçº¿ç¨‹ä»ç„¶éœ€è¦è¿è¡Œï¼Œæµªè´¹cpu</li><li>æ•°æ®å¤åˆ¶ï¼Œçº¿ç¨‹è¿˜æ˜¯é˜»å¡</li></ul><h3 id="æœåŠ¡å™¨ç«¯ä¿®æ”¹" tabindex="-1">æœåŠ¡å™¨ç«¯ä¿®æ”¹ <a class="header-anchor" href="#æœåŠ¡å™¨ç«¯ä¿®æ”¹" aria-hidden="true">#</a></h3><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;"> args</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> throws IOException </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">ByteBuffer</span><span style="color:#A6ACCD;"> buffer </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> ByteBuffer</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">allocate</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">16</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">ServerSocketChannel</span><span style="color:#A6ACCD;"> ssc</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">ServerSocketChannel</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">open</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">        ssc</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">configureBlocking</span><span style="color:#89DDFF;">(false);</span><span style="color:#676E95;font-style:italic;">//è®¾ç½®éé˜»å¡æ¨¡å¼</span></span>
<span class="line"><span style="color:#A6ACCD;">        ssc</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">bind</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">InetSocketAddress</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">8080</span><span style="color:#89DDFF;">));</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">List</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">SocketChannel</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> channels</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">ArrayList</span><span style="color:#89DDFF;">&lt;&gt;();</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">while</span><span style="color:#89DDFF;">(true){</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#C792EA;">SocketChannel</span><span style="color:#A6ACCD;"> sc </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> ssc</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">accept</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">sc</span><span style="color:#89DDFF;">!=null){</span></span>
<span class="line"><span style="color:#A6ACCD;">                sc</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">configureBlocking</span><span style="color:#89DDFF;">(false);</span></span>
<span class="line"><span style="color:#A6ACCD;">                channels</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">add</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">sc</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">SocketChannel</span><span style="color:#A6ACCD;"> channel </span><span style="color:#89DDFF;font-style:italic;">:</span><span style="color:#A6ACCD;"> channels</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> read </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> channel</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">read</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">buffer</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">read</span><span style="color:#89DDFF;">&gt;</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">){</span></span>
<span class="line"><span style="color:#A6ACCD;">                    buffer</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">flip</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">                    buffer</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">clear</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="å¤šè·¯å¤ç”¨" tabindex="-1">å¤šè·¯å¤ç”¨ <a class="header-anchor" href="#å¤šè·¯å¤ç”¨" aria-hidden="true">#</a></h3><p>å•çº¿ç¨‹å¯ä»¥é…åˆSelectorå®Œæˆå¯¹å¤šä¸ªchannelå¯è¯»å†™äº‹ä»¶çš„ç›‘æ§ï¼Œç§°ä¸ºå¤šè·¯å¤ç”¨</p><ul><li>å¤šè·¯å¤ç”¨åªé’ˆå¯¹ç½‘ç»œï¼ŒIOï¼Œæ™®é€šæ–‡ä»¶æ²¡æ³•åˆ©ç”¨å¤šè·¯å¤ç”¨</li><li>å¦‚æœä¸ä½¿ç”¨selectorï¼Œçº¿ç¨‹åœ¨æ²¡æœ‰è¿æ¥è¯·æ±‚çš„æ—¶å€™ä¹Ÿä¼šå ç”¨cpuï¼Œä½†æ˜¯selectorå¯ä»¥ä¿è¯ <ul><li>æœ‰äº‹ä»¶è¿æ¥æ‰å»è¯»å–</li><li>æœ‰å¯è¯»äº‹ä»¶æ‰å»è¯»å–</li><li>æœ‰å¯å†™äº‹ä»¶æ‰å»è¯»å– <ul><li>é™äºç½‘ç»œä¼ è¾“èƒ½åŠ›ï¼Œchannelæœªå¿…æ—¶æ—¶å¯å†™ï¼Œä¸€æ—¦channelå¯å†™ï¼Œä¼šè§¦å‘selectorçš„å¯å†™äº‹ä»¶</li></ul></li></ul></li></ul><h2 id="selector-1" tabindex="-1">selector <a class="header-anchor" href="#selector-1" aria-hidden="true">#</a></h2><h3 id="å¥½å¤„" tabindex="-1">å¥½å¤„ <a class="header-anchor" href="#å¥½å¤„" aria-hidden="true">#</a></h3><ul><li>ä¸€ä¸ªçº¿ç¨‹é…åˆselectorå¯ä»¥ç›‘æ§å¤šä¸ªchanneläº‹ä»¶ï¼Œäº‹ä»¶å‘ç”Ÿçº¿ç¨‹æ‰å»å¤„ç†</li><li>çº¿ç¨‹å……åˆ†åˆ©ç”¨</li><li>èŠ‚çº¦çº¿ç¨‹æ•°é‡</li><li>å‡å°‘çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢</li></ul><h3 id="åˆ›å»º" tabindex="-1">åˆ›å»º <a class="header-anchor" href="#åˆ›å»º" aria-hidden="true">#</a></h3><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">Selector</span><span style="color:#A6ACCD;"> selector </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Selector</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">open</span><span style="color:#89DDFF;">();</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="ç»‘å®šsocketchanneläº‹ä»¶" tabindex="-1">ç»‘å®šsocketChanneläº‹ä»¶ <a class="header-anchor" href="#ç»‘å®šsocketchanneläº‹ä»¶" aria-hidden="true">#</a></h3><p>åªæœ‰æ³¨å†Œåçš„äº‹ä»¶selectoræ‰ä¼šå…³å¿ƒ</p><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">Selector</span><span style="color:#A6ACCD;"> selector </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Selector</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">open</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">SocketChannel</span><span style="color:#A6ACCD;"> socketChannel </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> SocketChannel</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">open</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">        socketChannel</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">register</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">selector</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">ç»‘å®šäº‹ä»¶</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>channelå¿…é¡»å·¥ä½œåœ¨éé˜»å¡æ¨¡å¼</li><li>fileChannelæ²¡æœ‰éé˜»å¡æ¨¡å¼ä¹Ÿå°±ä¸èƒ½ä½¿ç”¨selector</li><li>ç»‘å®šäº‹ä»¶ç±»å‹ <ul><li>connent - å®¢æˆ·ç«¯è¿æ¥æˆåŠŸè§¦å‘</li><li>accept - æœåŠ¡å™¨ç«¯æˆåŠŸæ¥å—è§¦å‘</li><li>read - æ•°æ®å¯è¯»å…¥è§¦å‘</li><li>write - æ•°æ®å¯å†™å…¥è§¦å‘</li></ul><h3 id="ç›‘å¬channeläº‹ä»¶" tabindex="-1">ç›‘å¬channeläº‹ä»¶ <a class="header-anchor" href="#ç›‘å¬channeläº‹ä»¶" aria-hidden="true">#</a></h3><h4 id="æ–¹æ³•1-é˜»å¡åˆ°ç»‘å®šäº‹ä»¶å‘ç”Ÿ" tabindex="-1">æ–¹æ³•1:é˜»å¡åˆ°ç»‘å®šäº‹ä»¶å‘ç”Ÿ <a class="header-anchor" href="#æ–¹æ³•1-é˜»å¡åˆ°ç»‘å®šäº‹ä»¶å‘ç”Ÿ" aria-hidden="true">#</a></h4><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> count</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">selector</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">select</span><span style="color:#89DDFF;">();</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h4 id="æ–¹æ³•2-é˜»å¡åˆ°ç»‘å®šäº‹ä»¶å‘ç”Ÿæˆ–è€…è¶…æ—¶" tabindex="-1">æ–¹æ³•2ï¼šé˜»å¡åˆ°ç»‘å®šäº‹ä»¶å‘ç”Ÿæˆ–è€…è¶…æ—¶ <a class="header-anchor" href="#æ–¹æ³•2-é˜»å¡åˆ°ç»‘å®šäº‹ä»¶å‘ç”Ÿæˆ–è€…è¶…æ—¶" aria-hidden="true">#</a></h4><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> count</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">selector</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">select</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">long</span><span style="color:#A6ACCD;"> times</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h4 id="æ–¹æ³•3-ä¸ä¼šé˜»å¡-ä¹Ÿå°±æ˜¯ä¸ç®¡æœ‰æ²¡æœ‰äº‹ä»¶-ç«‹åˆ»è¿”å›-è‡ªå·±æ ¹æ®è¿”å›å€¼æ£€æŸ¥æ˜¯å¦æœ‰äº‹ä»¶" tabindex="-1">æ–¹æ³•3ï¼šä¸ä¼šé˜»å¡ï¼Œä¹Ÿå°±æ˜¯ä¸ç®¡æœ‰æ²¡æœ‰äº‹ä»¶ï¼Œç«‹åˆ»è¿”å›ï¼Œè‡ªå·±æ ¹æ®è¿”å›å€¼æ£€æŸ¥æ˜¯å¦æœ‰äº‹ä»¶ <a class="header-anchor" href="#æ–¹æ³•3-ä¸ä¼šé˜»å¡-ä¹Ÿå°±æ˜¯ä¸ç®¡æœ‰æ²¡æœ‰äº‹ä»¶-ç«‹åˆ»è¿”å›-è‡ªå·±æ ¹æ®è¿”å›å€¼æ£€æŸ¥æ˜¯å¦æœ‰äº‹ä»¶" aria-hidden="true">#</a></h4><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> count</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">selector</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">selectNow</span><span style="color:#89DDFF;">();</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="ğŸ’¡-select-ä½•æ—¶ä¸é˜»å¡" tabindex="-1">ğŸ’¡ select ä½•æ—¶ä¸é˜»å¡ <a class="header-anchor" href="#ğŸ’¡-select-ä½•æ—¶ä¸é˜»å¡" aria-hidden="true">#</a></h3></li></ul><blockquote><ul><li>äº‹ä»¶å‘ç”Ÿæ—¶ <ul><li>å®¢æˆ·ç«¯å‘èµ·è¿æ¥è¯·æ±‚ï¼Œä¼šè§¦å‘ accept äº‹ä»¶</li><li>å®¢æˆ·ç«¯å‘é€æ•°æ®è¿‡æ¥ï¼Œå®¢æˆ·ç«¯æ­£å¸¸ã€å¼‚å¸¸å…³é—­æ—¶ï¼Œéƒ½ä¼šè§¦å‘ read äº‹ä»¶ï¼Œå¦å¤–å¦‚æœå‘é€çš„æ•°æ®å¤§äº buffer ç¼“å†²åŒºï¼Œä¼šè§¦å‘å¤šæ¬¡è¯»å–äº‹ä»¶</li><li>channel å¯å†™ï¼Œä¼šè§¦å‘ write äº‹ä»¶</li><li>åœ¨ linux ä¸‹ nio bug å‘ç”Ÿæ—¶</li></ul></li><li>è°ƒç”¨ selector.wakeup()</li><li>è°ƒç”¨ selector.close()</li><li>selector æ‰€åœ¨çº¿ç¨‹ interrupt</li></ul></blockquote><h2 id="å¤„ç†acceptäº‹ä»¶" tabindex="-1">å¤„ç†acceptäº‹ä»¶ <a class="header-anchor" href="#å¤„ç†acceptäº‹ä»¶" aria-hidden="true">#</a></h2><p>å®¢æˆ·ç«¯ä»£ç </p><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;"> args</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> throws IOException </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">try</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">Socket</span><span style="color:#A6ACCD;"> socket </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Socket</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">localhost</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">8080</span><span style="color:#89DDFF;">))</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">socket</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">            socket</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getOutputStream</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">write</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">world</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getBytes</span><span style="color:#89DDFF;">());</span></span>
<span class="line"><span style="color:#A6ACCD;">            System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">in</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">read</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>æœåŠ¡å™¨ç«¯ä»£ç </p><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;"> args</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> throws IOException </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">try</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">ServerSocketChannel</span><span style="color:#A6ACCD;"> channel </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> ServerSocketChannel</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">open</span><span style="color:#89DDFF;">())</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            channel</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">bind</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">InetSocketAddress</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">8080</span><span style="color:#89DDFF;">));</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#C792EA;">Selector</span><span style="color:#A6ACCD;"> selector </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Selector</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">open</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">            channel</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">configureBlocking</span><span style="color:#89DDFF;">(false);</span></span>
<span class="line"><span style="color:#A6ACCD;">            channel</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">register</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">selector</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> SelectionKey</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">OP_ACCEPT</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;font-style:italic;">while</span><span style="color:#89DDFF;">(true){</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> count </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> selector</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">select</span><span style="color:#89DDFF;">();</span><span style="color:#676E95;font-style:italic;">//æ²¡æœ‰ç»‘å®šäº‹ä»¶çš„æ—¶å€™é˜»å¡ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰æœåŠ¡ç«¯å“åº”å®¢æˆ·ç«¯è¿æ¥å‰ä¸€ç›´é˜»å¡</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#C792EA;">Set</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">SelectionKey</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> keys </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> selector</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">selectedKeys</span><span style="color:#89DDFF;">();</span><span style="color:#676E95;font-style:italic;">//è·å–æ‰€æœ‰äº‹ä»¶accept</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#C792EA;">Iterator</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">SelectionKey</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> iter </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> keys</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">iterator</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;font-style:italic;">while</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">iter</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">hasNext</span><span style="color:#89DDFF;">()){</span></span>
<span class="line"><span style="color:#89DDFF;">                    </span><span style="color:#676E95;font-style:italic;">//ä¸ºä»€ä¹ˆä¸ä½¿ç”¨å¢å¼ºforå¾ªç¯ï¼Œåœ¨å¢å¼ºforä¸­æˆ‘ä»¬ä¸èƒ½åˆ é™¤å…ƒç´ ï¼Œä½†æ˜¯åœ¨è¿­ä»£å™¨ä¸­æˆ‘ä»¬å¯ä»¥åˆ é™¤å…ƒç´ </span></span>
<span class="line"><span style="color:#A6ACCD;">                    </span><span style="color:#C792EA;">SelectionKey</span><span style="color:#A6ACCD;"> key </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> iter</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">next</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">                    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">key</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">isAcceptable</span><span style="color:#89DDFF;">()){</span></span>
<span class="line"><span style="color:#89DDFF;">                        </span><span style="color:#676E95;font-style:italic;">//åˆ¤æ–­äº‹ä»¶ç±»å‹</span></span>
<span class="line"><span style="color:#A6ACCD;">                        </span><span style="color:#89DDFF;font-style:italic;">try</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                        </span><span style="color:#C792EA;">ServerSocketChannel</span><span style="color:#A6ACCD;"> c </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">ServerSocketChannel</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">key</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">channel</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">                        </span><span style="color:#C792EA;">ByteBuffer</span><span style="color:#A6ACCD;"> buffer</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">ByteBuffer</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">allocate</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">16</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">                        </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> read</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">channel</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">read</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">buffer</span><span style="color:#89DDFF;">);</span><span style="color:#676E95;font-style:italic;">//æ­£å¸¸æ–­å¼€è¿”å›-1</span></span>
<span class="line"><span style="color:#A6ACCD;">                        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">read</span><span style="color:#89DDFF;">==-</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">){</span></span>
<span class="line"><span style="color:#A6ACCD;">                            key</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">cancel</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">                        </span><span style="color:#89DDFF;">}</span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                            buffer</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">flip</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">                            </span></span>
<span class="line"><span style="color:#A6ACCD;">                        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">                        </span><span style="color:#89DDFF;">}</span><span style="color:#89DDFF;font-style:italic;">catch</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">IOEcpection</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">e</span><span style="color:#89DDFF;">){</span></span>
<span class="line"><span style="color:#A6ACCD;">                            e</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">printStarce</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">                            key</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">cancel</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">                        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">                        </span></span>
<span class="line"><span style="color:#A6ACCD;">                    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">                    iter</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">remove</span><span style="color:#89DDFF;">();</span><span style="color:#676E95;font-style:italic;">//åˆ é™¤äº‹ä»¶</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><h3 id="ä¸ºä»€ä¹ˆè¿›è¡Œiter-remove" tabindex="-1">ä¸ºä»€ä¹ˆè¿›è¡Œiter.remove() <a class="header-anchor" href="#ä¸ºä»€ä¹ˆè¿›è¡Œiter-remove" aria-hidden="true">#</a></h3><ul><li>åœ¨selectäº‹ä»¶è§¦å‘åï¼Œå°†ç›¸å…³çš„keyæ”¾åœ¨selectKeysä¸­ï¼Œä½†ä¸ä¼šç§»é™¤ï¼Œsuch as</li><li>ç¬¬ä¸€æ¬¡è§¦å‘acceptäº‹ä»¶ï¼Œæ²¡æœ‰ç§»é™¤sscKey</li><li>ç¬¬äºŒæ¬¡è§¦å‘scKeyä¸­çš„readäº‹ä»¶ï¼Œåœ¨é›†åˆä¸­è¿˜æœ‰ä¸Šæ¬¡çš„sscKeyï¼Œåœ¨å¤„ç†æ²¡æœ‰serverSocketè¿æ¥ï¼Œå°±ä¼šå¯¼è‡´ç©ºæŒ‡é’ˆ</li></ul><h3 id="ğŸ’¡-cancel" tabindex="-1">ğŸ’¡ cancel <a class="header-anchor" href="#ğŸ’¡-cancel" aria-hidden="true">#</a></h3><ul><li>cancelä¼šå–æ¶ˆæ³¨å†Œåœ¨selectorçš„channelï¼Œå¹¶ä»keysé›†åˆåˆ é™¤keyï¼Œselectorä¸å†ç›‘å¬channel</li></ul><h3 id="ä¸å¤„ç†è¾¹ç•Œçš„é—®é¢˜" tabindex="-1">ä¸å¤„ç†è¾¹ç•Œçš„é—®é¢˜ <a class="header-anchor" href="#ä¸å¤„ç†è¾¹ç•Œçš„é—®é¢˜" aria-hidden="true">#</a></h3><p>æœåŠ¡å™¨ç«¯</p><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Server</span><span style="color:#89DDFF;">(){</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#C792EA;">ServerSocket</span><span style="color:#A6ACCD;"> ss </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">ServerSocket</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">8080</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">while</span><span style="color:#89DDFF;">(true){</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#C792EA;">Socket</span><span style="color:#A6ACCD;"> s </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> ss</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">accept</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#C792EA;">InputStream</span><span style="color:#A6ACCD;"> in </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> s</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getInputStream</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#C792EA;">byte</span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;"> arr</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">byte</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">4</span><span style="color:#89DDFF;">];</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;font-style:italic;">while</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(true){</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> read </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> in</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">read</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">arr</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">read</span><span style="color:#89DDFF;">==-</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">){</span></span>
<span class="line"><span style="color:#A6ACCD;">                    </span><span style="color:#89DDFF;font-style:italic;">break</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">                System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">String</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">arr</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">read</span><span style="color:#89DDFF;">));</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>å®¢æˆ·ç«¯</p><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#C792EA;">Socket</span><span style="color:#A6ACCD;"> socket</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Socket</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">localhost</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">8080</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#C792EA;">OutputStream</span><span style="color:#A6ACCD;"> out</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">socket</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getOutputStream</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">write</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">hello</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getBytes</span><span style="color:#89DDFF;">());</span></span>
<span class="line"><span style="color:#A6ACCD;">sicket</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">close</span><span style="color:#89DDFF;">();</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div>`,41),o=[e];function c(r,t,D,y,F,i){return n(),a("div",null,o)}const u=s(p,[["render",c]]);export{C as __pageData,u as default};
